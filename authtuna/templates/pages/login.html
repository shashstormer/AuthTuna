<!DOCTYPE html>

<html lang="en" class="light">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Login</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>

    :root {

      /* Light Mode Gradient (Teal/Cyan) */

      --bg-start: hsla(202, 71%, 27%, 1);

      --bg-end: hsla(176, 45%, 66%, 1);

    }



    .dark {

      /* Dark Mode Gradient (Purple) */

      --bg-start: hsla(252, 40%, 29%, 1);

      --bg-end: hsla(270, 77%, 71%, 1);

    }



    body {

      font-family: 'Poppins', sans-serif;

      background: linear-gradient(90deg, var(--bg-start), var(--bg-end));

      background-size: 400% 400%;

      animation: gradientAnimation 15s ease infinite;

      transition: background 0.5s ease-in-out;

    }



    @keyframes gradientAnimation {

      0% { background-position: 0% 50%; }

      50% { background-position: 100% 50%; }

      100% { background-position: 0% 50%; }

    }



    /* Glassmorphism card effect */

    .bg-card {

      backdrop-filter: blur(20px);

      -webkit-backdrop-filter: blur(20px);

      background-clip: padding-box;

    }



    .dark .bg-card {

      background-color: rgba(0, 0, 0, 0.2);

      border: 1px solid rgba(255, 255, 255, 0.15);

    }

    .light .bg-card {

      background-color: rgba(255, 255, 255, 0.2);

      border: 1px solid rgba(255, 255, 255, 0.25);

    }



    /* Input field styling */

    .form-input {

      border: 1px solid transparent;

      transition: all 0.2s ease-in-out;

    }

    .dark .form-input {

        background-color: rgba(0, 0, 0, 0.25);

        border-color: rgba(100, 100, 100, 0.4);

    }

    .light .form-input {

        background-color: rgba(255, 255, 255, 0.25);

        border-color: rgba(255, 255, 255, 0.4);

    }

    .form-input:focus {

        border-color: #a78bfa;

        box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.5);

        background-color: rgba(0, 0, 0, 0.3);

    }

    .light .form-input:focus {

        border-color: #6366f1;

        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5);

        background-color: rgba(255, 255, 255, 0.3);

    }

    /* Placeholder color */

    .dark .form-input::placeholder { color: rgba(156, 163, 175, 0.6); }

    .light .form-input::placeholder { color: rgba(255, 255, 255, 0.7); }

  </style>

  <script>

    function setTheme(theme) {

      document.documentElement.classList.toggle('dark', theme === 'dark');

      localStorage.setItem('theme', theme);

    }

    document.addEventListener('DOMContentLoaded', () => {

        const storedTheme = localStorage.getItem('theme');

        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        setTheme(storedTheme || (prefersDark ? 'dark' : 'light'));

    });

    function toggleTheme() {

      const isDark = document.documentElement.classList.contains('dark');

      setTheme(isDark ? 'light' : 'dark');

    }

  </script>

</head>

<body class="min-h-screen flex items-center justify-center p-4

             text-gray-800 dark:text-gray-100">



  <div class="bg-card shadow-2xl rounded-3xl p-8 w-full max-w-sm relative">

    <button onclick="toggleTheme()" class="absolute top-4 right-4 p-2 rounded-full

                                          text-white/70 hover:text-white

                                          hover:bg-white/20 dark:hover:bg-black/20 transition-colors duration-200">

      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 7.625A.75.75 0 018.25 7.5h.75a.75.75 0 01.75.75v.75a.75.75 0 01-.75.75h-.75A.75.75 0 017.5 8.375v-.75zM15 7.5a.75.75 0 01.75.75v.75a.75.75 0 01-1.5 0v-.75a.75.75 0 01.75-.75zM17.65 6.33a.75.75 0 011.06 0l1.06 1.06a.75.75 0 010 1.06l-1.06 1.06a.75.75 0 01-1.06 0L17.65 7.39a.75.75 0 010-1.06zM6.34 17.65a.75.75 0 010-1.06l1.06-1.06a.75.75 0 011.06 0l1.06 1.06a.75.75 0 010 1.06l-1.06 1.06a.75.75 0 01-1.06 0zM12 17.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V18a.75.75 0 01.75-.75zM2.25 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3a.75.75 0 01-.75-.75zM18 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5h-2.25a.75.75 0 01-.75-.75zM12 7.5a4.5 4.5 0 100 9 4.5 4.5 0 000-9z" /></svg>

    </button>

    <div class="text-center mb-8">

      <div class="w-16 h-16 mx-auto bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center text-white text-3xl font-bold shadow-lg mb-4">

        ðŸ”’

      </div>

      <h1 class="text-4xl font-semibold text-white/95 leading-tight">Welcome Back</h1>

      <p class="text-md text-white/70 mt-1">Sign in to your account</p>

    </div>



    <form id="login-form" class="space-y-6">

      <div>

        <label for="username_or_email" class="block text-sm font-medium text-white/80 mb-2">Username or Email</label>

        <input id="username_or_email" name="username_or_email" type="text" required

          class="form-input block w-full px-5 py-3 rounded-xl text-white">

        <p id="username-error" class="text-xs text-red-300/80 mt-1 hidden">

          Must be at least 3 characters, no spaces, alphanumeric with `_` or `-`, and at least 3 letters.

        </p>

      </div>

      <div>

        <label for="password" class="block text-sm font-medium text-white/80 mb-2">Password</label>

        <input id="password" name="password" type="password" autocomplete="current-password" required

          class="form-input block w-full px-5 py-3 rounded-xl text-white">

        <p id="password-error" class="text-xs text-red-300/80 mt-1 hidden">

          Password must be at least 8 characters with at least one uppercase and one lowercase letter.

        </p>

      </div>



      <div id="message-box" class="mt-4 text-center text-sm font-medium hidden"></div>



      <div class="flex items-center justify-between text-sm mt-6">

        <a href="/auth/forgot-password" class="font-medium text-purple-300 hover:text-purple-200 light:text-cyan-200 light:hover:text-white transition-colors duration-200">Forgot password?</a>

        <a href="/auth/signup" class="font-medium text-purple-300 hover:text-purple-200 light:text-cyan-200 light:hover:text-white transition-colors duration-200">Create account</a>

      </div>



      <button type="submit"

        class="w-full py-3 px-4 rounded-xl font-semibold text-white text-lg

               bg-gradient-to-r from-indigo-600 to-purple-600

               hover:from-indigo-700 hover:to-purple-700

               focus:ring-4 focus:ring-indigo-300 dark:focus:ring-purple-700

               shadow-xl hover:shadow-2xl transition-all duration-300 ease-in-out transform hover:-translate-y-0.5">

        Sign In

      </button>

    </form>

  </div>

  <script>

    const form = document.getElementById('login-form');

const messageBox = document.getElementById('message-box');

const usernameInput = document.getElementById('username_or_email');

const passwordInput = document.getElementById('password');

const usernameError = document.getElementById('username-error');

const passwordError = document.getElementById('password-error');



// Client-side validation logic

function validateUsername(username) {

    if (username.length < 3) return false;

    if (username.includes(" ")) return false;

    const alphanumericOrHyphenUnderscore = /^[a-zA-Z0-9_-]+$/.test(username);

    if (!alphanumericOrHyphenUnderscore) return false;

    const hasThreeAlphabets = (username.match(/[a-zA-Z]/g) || []).length >= 3;

    if (!hasThreeAlphabets) return false;

    return true;

}



function validatePassword(password) {

    if (password.length < 8) return false;

    if (!/[a-z]/.test(password)) return false;

    if (!/[A-Z]/.test(password)) return false;

    return true;

}



function showMessage(text, colorClass) {

  messageBox.textContent = text;

  messageBox.className = `mt-4 text-center text-sm font-medium ${colorClass}`;

  messageBox.style.display = 'block';

}



usernameInput.addEventListener('input', () => {

    if (validateUsername(usernameInput.value)) {

        usernameError.classList.add('hidden');

    } else {

        usernameError.classList.remove('hidden');

    }

});



passwordInput.addEventListener('input', () => {

    if (validatePassword(passwordInput.value)) {

        passwordError.classList.add('hidden');

    } else {

        passwordError.classList.remove('hidden');

    }

});



form.addEventListener('submit', async (e) => {

  e.preventDefault();

  const usernameOrEmail = usernameInput.value;

  const password = passwordInput.value;



  // Prevent submission if client-side validation fails

  if (!validateUsername(usernameOrEmail) || !validatePassword(password)) {

      showMessage('Please fix the validation errors.', 'text-red-500 dark:text-red-300');

      return;

  }



  try {

    const response = await fetch('/auth/login', {

      method: 'POST',

      headers: { 'Content-Type': 'application/json' },

      body: JSON.stringify({ username_or_email: usernameOrEmail, password: password })

    });



    const data = await response.json();

    if (response.ok) {

      showMessage(data.message, 'text-green-500 dark:text-green-300');

      setTimeout(() => window.location.href = '/', 1500);

    } else {

      showMessage(data.detail || 'Invalid username or password.', 'text-red-500 dark:text-red-300');

    }

  } catch {

    showMessage('Network error. Please try again.', 'text-red-500 dark:text-red-300');

  }

});

  </script>

</body>

</html>
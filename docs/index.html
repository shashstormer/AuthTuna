<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuthTuna üêü - Asynchronous Security Framework</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>

    <style>
        :root {
            --primary: #8b5cf6; /* Indigo-500 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #030712; /* Gray-950 */
        }
        /* Custom scrolling for content area */
        .doc-content-area::-webkit-scrollbar { width: 8px; }
        .doc-content-area::-webkit-scrollbar-thumb { background-color: #374151; border-radius: 4px; }
        .doc-content-area::-webkit-scrollbar-track { background: #1f2937; }

        /* Prose styling equivalent for generated content */
        .prose h1, .prose h2, .prose h3, .prose h4 {
            color: #f3f4f6; /* White */
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        .prose h1 { font-size: 2.5rem; font-weight: 800; }
        .prose h2 { font-size: 1.75rem; font-weight: 700; border-bottom: 1px solid #374151; padding-bottom: 0.5rem; }
        .prose h3 { font-size: 1.25rem; font-weight: 600; }
        .prose h4 { font-size: 1.1rem; font-weight: 600; color: #a5b4fc; }
        .prose p, .prose li { color: #d1d5db; line-height: 1.7; }
        .prose ul, .prose ol { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .prose a { color: #a5b4fc; text-decoration: none; }
        .prose a:hover { text-decoration: underline; }
        .prose code {
            background-color: #1f2937; /* Gray-800 */
            padding: 0.2rem 0.4rem;
            border-radius: 0.375rem;
            color: #facc15; /* Amber-400 */
            font-size: 0.875rem;
        }
        .prose pre {
            background-color: #111827; /* Gray-900 */
            border: 1px solid #374151;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        .prose pre code {
            background: none;
            color: #e5e7eb; /* Gray-200 */
            padding: 0;
            font-size: 1rem;
        }
        .prose table { width: 100%; }
        .prose th { background-color: #1f2937; }
    </style>
</head>
<body class="text-gray-200">

    <div class="flex h-screen overflow-hidden">

        <nav id="sidebar" class="w-64 bg-gray-900 p-6 border-r border-gray-800 flex-shrink-0 overflow-y-auto absolute md:relative transform -translate-x-full md:translate-x-0 transition-transform duration-200 ease-in-out z-30">
            <div class="sticky top-0 pb-6 bg-gray-900 z-10">
                <h1 class="text-3xl font-extrabold text-indigo-400">AuthTuna üêü</h1>
                <p class="text-sm text-gray-500 mt-1">v0.1.8 Docs</p>
            </div>

            <div class="space-y-2">
                <h2 class="text-lg font-semibold text-gray-400 mt-4 mb-2 uppercase tracking-wider">Fundamentals</h2>
                <a href="#introduction" onclick="navigate('introduction')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="introduction">
                    Introduction & Setup
                </a>
                <a href="#configuration" onclick="navigate('configuration')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="configuration">
                    Configuration (`Settings`)
                </a>
                <a href="#core-managers" onclick="navigate('core-managers')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="core-managers">
                    Core Service Layer
                </a>

                <h2 class="text-lg font-semibold text-gray-400 mt-6 mb-2 uppercase tracking-wider">FastAPI Integration</h2>
                <a href="#dependencies" onclick="navigate('dependencies')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="dependencies">
                    Dependencies
                </a>
                <a href="#permission-dependencies" onclick="navigate('permission-dependencies')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="permission-dependencies">
                    Role & Permission Checks
                </a>
                 <a href="#rbac-management" onclick="navigate('rbac-management')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="rbac-management">
                    RBAC Management
                </a>

                <h2 class="text-lg font-semibold text-gray-400 mt-6 mb-2 uppercase tracking-wider">Built-in Features</h2>
                <a href="#auth-flows" onclick="navigate('auth-flows')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="auth-flows">
                    Authentication Flows
                </a>
                <a href="#mfa" onclick="navigate('mfa')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="mfa">
                    MFA & Social Login (SSO)
                </a>
                <a href="#middleware-session" onclick="navigate('middleware-session')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="middleware-session">
                    Middleware & Session Mgmt
                </a>
                 <a href="#ui-dashboard" onclick="navigate('ui-dashboard')" class="nav-link block p-2 rounded-lg transition-colors hover:bg-gray-800" data-page="ui-dashboard">
                    UI Dashboard
                </a>

            </div>
        </nav>

        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden" onclick="toggleSidebar()"></div>

        <main class="flex-1 overflow-y-auto p-8 lg:p-12 doc-content-area">
             <button id="menu-button" class="md:hidden fixed top-4 right-4 bg-gray-800 p-2 rounded-lg z-40">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <div id="content" class="prose max-w-4xl mx-auto">
                </div>
        </main>
    </div>

    <script>
        const contentDiv = document.getElementById('content');
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = {};

        // --- Documentation Content (Simulated Pages) ---
        pages['introduction'] = `
            <h1>AuthTuna üêü - High-Performance Async Security</h1>
            <p class="lead">AuthTuna is a modern, batteries-included authentication and authorization framework for Python, designed specifically for **FastAPI** applications, but with a framework-agnostic core.</p>

            <h2>Key Features</h2>
            <ul>
                <li><strong>Async-First:</strong> Built entirely with asynchronous managers and SQLAlchemy 2.0.</li>
                <li><strong>Robust Sessions:</strong> DB-backed sessions with anti-hijack checks (device/region/IP mismatch).</li>
                <li><strong>Comprehensive RBAC:</strong> Hierarchical roles and fine-grained **Scoped Permissions**.</li>
                <li><strong>Built-in Flows:</strong> Ready-to-use routers for Login, Signup, MFA, Password Reset, and Social SSO.</li>
                <li><strong>Auditing:</strong> Logs all critical security events (login, password change, suspension).</li>
                <li><strong>UI Components:</strong> Includes pre-built HTML templates for login, user dashboard, settings, and admin pages.</li>
            </ul>

            <h2>Getting Started (Minimal Setup)</h2>
            <p>Install dependencies and initialize your FastAPI application:</p>
            <pre><code class="language-bash">pip install authtuna</code></pre>

            <h4>1. Create a minimal .env file</h4>
            <pre><code class="language-bash"># .env
API_BASE_URL=http://localhost:8000
# Mandatory encryption keys (generate with Fernet.generate_key().decode())
FERNET_KEYS='["YOUR_PRIMARY_KEY", "YOUR_SECONDARY_KEY"]'
JWT_SECRET_KEY="a-strong-jwt-secret"
DEFAULT_DATABASE_URI=sqlite+aiosqlite:///./authtuna.db
</code></pre>

            <h4>2. Initialize the App</h4>
            <pre><code class="language-python">from fastapi import FastAPI, Depends
from authtuna import init_app
from authtuna.integrations import get_current_user
from authtuna.core.database import User

app = FastAPI(title="AuthTuna Demo API")

# This single function adds all middleware and routers
init_app(app)

@app.get("/", tags=["Root"],)
async def root(user=Depends(get_current_user_optional)):
    """
    Automatically redirects to login page if not authenticated, else redirects to the dashboard.
    """
    if user is None:
        return RedirectResponse("/auth/login")
    return RedirectResponse("/ui/dashboard")

</code></pre>
            <p>After running your app, you can access the built-in UI at <a href="/ui/dashboard">/ui/dashboard</a> and authentication forms at <a href="/auth/login">/auth/login</a>.</p>
        `;

        pages['configuration'] = `
            <h1>Configuration (\`Settings\` Reference)</h1>
            <h2>CHECK THE README.MD for more env vars you want to set before pushing to prod. I will be enhancing docs later but for now readme.md, Thanks for understanding.</h2>
            <p>AuthTuna uses Pydantic settings, loading configuration from environment variables or a <code>.env</code> file. Secrets use <code>SecretStr</code> to prevent accidental logging.</p>

            <h2>Critical & Database Settings</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-400 rounded-lg">
                    <thead class="text-xs uppercase bg-gray-800 text-gray-300">
                        <tr>
                            <th scope="col" class="py-3 px-6">Variable</th>
                            <th scope="col" class="py-3 px-6">Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-gray-900 border-b border-gray-800">
                            <th scope="row" class="py-4 px-6 font-medium whitespace-nowrap text-white">API_BASE_URL</th>
                            <td class="py-4 px-6">Base URL for generating email links and OAuth redirects. (Required)</td>
                        </tr>
                        <tr class="bg-gray-900 border-b border-gray-800">
                            <th scope="row" class="py-4 px-6 font-medium whitespace-nowrap text-white">FERNET_KEYS</th>
                            <td class="py-4 px-6">List of base64 keys for session encryption. The first is for encryption, others for decryption during rotation. (Required)</td>
                        </tr>
                        <tr class="bg-gray-900 border-b border-gray-800">
                            <th scope="row" class="py-4 px-6 font-medium whitespace-nowrap text-white">DEFAULT_DATABASE_URI</th>
                            <td class="py-4 px-6">Async SQLAlchemy connection string. Defaults to <code>sqlite+aiosqlite:///./authtuna_dev.db</code>.</td>
                        </tr>
                        <tr class="bg-gray-900 border-b border-gray-800">
                            <th scope="row" class="py-4 px-6 font-medium whitespace-nowrap text-white">AUTO_CREATE_DATABASE</th>
                            <td class="py-4 px-6">If <code>True</code>, creates tables and provisions default roles/users on startup. Defaults to <code>True</code>.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>Session & Security Settings</h2>
             <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-400 rounded-lg">
                     <thead class="text-xs uppercase bg-gray-800 text-gray-300">
                        <tr>
                            <th scope="col" class="py-3 px-6">Variable</th>
                            <th scope="col" class="py-3 px-6">Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-gray-900 border-b border-gray-800">
                            <th scope="row" class="py-4 px-6 font-medium whitespace-nowrap text-white">SESSION_DB_VERIFICATION_INTERVAL</th>
                            <td class="py-4 px-6">Seconds between database re-checks for a session's validity. Defaults to <code>10</code>.</td>
                        </tr>
                        <tr class="bg-gray-900 border-b border-gray-800">
                            <th scope="row" class="py-4 px-6 font-medium whitespace-nowrap text-white">SESSION_LIFETIME_SECONDS</th>
                            <td class="py-4 px-6">Time until session times out from inactivity. Defaults to 7 days.</td>
                        </tr>
                        <tr class="bg-gray-900 border-b border-gray-800">
                            <th scope="row" class="py-4 px-6 font-medium whitespace-nowrap text-white">STRATEGY</th>
                            <td class="py-4 px-6">Authentication mechanism: <code>COOKIE</code> (default) or <code>BEARER</code>. Curr it dosent return the Token in bearer so if cookie accessible in app then you can use it, will be returning soon after implementing and testing.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        `;

        pages['core-managers'] = `
            <h1>Core Service Layer (\`AuthTunaAsync\`)</h1>
            <p>The entire library core is exposed through asynchronous manager classes. The main entry point is the <code>auth_service</code> instance from <code>authtuna.integrations</code>.</p>

            <h4>UserManager</h4>
            <p>Handles user lifecycle and data management.</p>
            <pre><code class="language-python"># Example: Suspending a user
from authtuna.integrations import auth_service

async def suspend(user_id, admin_id):
    suspended_user = await auth_service.users.suspend_user(
        user_id=user_id,
        admin_id=admin_id,
        reason="Violated ToS"
    )
    return suspended_user.is_active # Returns False
</code></pre>

            <h4>SessionManager</h4>
            <p>Directly manages database sessions, terminations, and retrieval.</p>
            <pre><code class="language-python"># Example: Terminate all other sessions for a user
async def cleanup_sessions(user_id, current_session_id, ip_address):
    await auth_service.sessions.terminate_all_for_user(
        user_id=user_id,
        ip_address=ip_address,
        except_session_id=current_session_id
    )
</code></pre>

            <h4>RoleManager & PermissionManager</h4>
            <p>Manages the RBAC system, including creating roles/permissions and assigning them. See the <a href="#rbac-management" onclick="navigate('rbac-management')">RBAC Management</a> section for details.</p>
        `;

        pages['dependencies'] = `
            <h1>FastAPI Integration: Dependencies</h1>
            <p>AuthTuna provides powerful FastAPI dependencies to handle authentication and authorization efficiently.</p>

            <h4>\`get_current_user\`</h4>
            <p>The standard authentication dependency. It retrieves the complete <code>User</code> object from the database or raises a <code>401 Unauthorized</code> error.</p>
            <pre><code class="language-python">from fastapi import Depends
from authtuna.integrations import get_current_user
from authtuna.core.database import User

@app.get("/profile")
async def get_my_profile(user: User = Depends(get_current_user)):
    return {"username": user.username, "roles": [r.name for r in user.roles]}
</code></pre>

            <h4>\`get_current_user_optional\`</h4>
            <p>Used for routes accessible to both authenticated and unauthenticated users. Returns <code>User</code> or <code>None</code>.</p>
            <pre><code class="language-python">from typing import Optional
from authtuna.integrations import get_current_user_optional

@app.get("/")
async def homepage(user: Optional[User] = Depends(get_current_user_optional)):
    if user:
        return f"Hello, {user.username}"
    return "Hello, Guest"
</code></pre>
        `;

        pages['permission-dependencies'] = `
            <h1>Role & Permission Checks</h1>
            <p>Protect your endpoints by requiring specific roles or fine-grained permissions.</p>

            <h4>\`RoleChecker\`</h4>
            <p>Enforces that the user has all specified roles. Raises <code>403 Forbidden</code> if any role is missing.</p>
            <pre><code class="language-python">from authtuna.integrations import RoleChecker

# Requires BOTH 'Admin' AND 'Moderator' roles
@app.delete("/content/{id}", dependencies=[Depends(RoleChecker("Admin", "Moderator"))])
async def delete_content():
    return {"status": "Deletion authorized"}
</code></pre>

            <h4>\`PermissionChecker\` (Scoped Authorization)</h4>
            <p>The most flexible dependency. It checks for a named permission and supports scoping based on URL parameters.</p>

            <p>The <code>scope_from_path</code> parameter automatically constructs a scope string (e.g., <code>project:456</code>) and checks for permissions valid in that specific scope or the <code>global</code> scope.</p>
            <pre><code class="language-python">@app.patch("/project/{project_id}/settings")
async def update_project(
    project_id: str,
    # Checks for "project:write:settings" in scope "project:{project_id}"
    user = Depends(PermissionChecker("project:write:settings", scope_from_path="project_id"))
):
    return {"status": "Project update authorized"}
</code></pre>
        `;

        pages['rbac-management'] = `
            <h1>RBAC Management</h1>
            <p>The <code>auth_service.roles</code> manager handles all logic for creating, assigning, and checking roles and permissions. The built-in <code>/admin</code> router provides API endpoints for these actions.</p>

            <h4>Authorization for Management</h4>
            <p>AuthTuna uses a hybrid model for managing roles. An admin can assign a role if any of these are true:</p>
            <ol class="list-decimal pl-6 space-y-2">
                <li><strong>Specific Permission:</strong> The admin has a permission like <code>roles:assign:Moderator</code>.</li>
                <li><strong>Role Hierarchy:</strong> The admin's highest role level is greater than the target role's level (e.g., Admin at level 90 can assign Moderator at level 50).</li>
                <li><strong>Explicit Grant:</strong> The admin's role is explicitly granted permission to assign the target role.</li>
            </ol>

            <h4>Default Roles & Users</h4>
            <p>When <code>AUTO_CREATE_DATABASE</code> is enabled, AuthTuna provisions essential roles and users for immediate administration.</p>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-400 rounded-lg">
                    <thead class="text-xs uppercase bg-gray-800 text-gray-300">
                        <tr>
                            <th scope="col" class="py-3 px-6">Role Name</th>
                            <th scope="col" class="py-3 px-6">Level</th>
                            <th scope="col" class="py-3 px-6">Key Permissions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>System</td><td>999</td><td>This user is for automated tasks requiring permissions like assign-ing project owner on when creating new project or smth.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>SuperAdmin</td><td>100</td><td>Full system access.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>Admin</td><td>90</td><td>User and role management.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>Moderator</td><td>50</td><td>Basic user management.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>User</td><td>10</td><td>Standard application access.</td></tr>
                    </tbody>
                    <ul>
                       <li><strong>system:</strong> Internal ID: <code>system</code>. Used for audit logging and initial role assignments. Due to its high level (999), it can be used for automated role assignments without requiring explicit grants (if the role being assigned has a level < 999).</li>
                        <li><strong>superadmin:</strong> Default Email: <code>settings.DEFAULT_SUPERADMIN_EMAIL</code>. Assigned <code>SuperAdmin</code> role.</li>
                        <li><strong>admin:</strong> Default Email: <code>settings.DEFAULT_ADMIN_EMAIL</code>. Assigned <code>Admin</code> role.</li>
                    </ul>
                </table>
            </div>
        `;

        pages['auth-flows'] = `
            <h1>Authentication Flows & Endpoints</h1>
            <p>The <code>auth_router</code> provides all necessary API endpoints and HTML pages for a complete security system.</p>
            <p>Just use the pages included in the router and if you want custom pages update the env var for templates dir ALL THE PAGES NEED TO BE INCLUDED IN THE NEW FOLDER AS I HAVE NOT IMPLEMENTED FALLBACK YET. Just copy paste dir if you want to update theme. (Maybe ima add theme configuration so that ppl wont have to copy pasta all files, no guarantee just thinking.)</p>

            <h4>Standard Authentication (\`/auth\`)</h4>
            <p>These endpoints handle user credentials and password security.</p>
             <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-400 rounded-lg">
                     <thead class="text-xs uppercase bg-gray-800 text-gray-300">
                        <tr><th class="py-3 px-6">Endpoint</th><th class="py-3 px-6">Method</th><th class="py-3 px-6">Function</th></tr>
                    </thead>
                    <tbody>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>/auth/signup</td><td>POST</td><td>User registration.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>/auth/login</td><td>POST</td><td>User login.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>/auth/logout</td><td>POST</td><td>Terminates the current session.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>/auth/forgot-password</td><td>POST</td><td>Initiates password reset flow.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>/auth/reset-password</td><td>POST</td><td>Completes password reset with a valid token.</td></tr>
                    </tbody>
                </table>
            </div>

            <h4>Redirect on Login</h4>
            <p>To enhance user experience, you can redirect users to a specific page after login by appending a <code>return_url</code> query parameter to the login page URL. The middleware will store this URL in a temporary cookie.</p>
            <pre><code class="language-bash"># Example: This will redirect the user to /settings after they log in.
http://localhost:8000/auth/login?return_url=/ui/settings</code></pre>
        `;

        pages['mfa'] = `
            <h1>MFA & Social Login (SSO)</h1>

            <h4>Multi-Factor Authentication (\`/mfa\`)</h4>
            <p>AuthTuna implements the TOTP standard (compatible with Google Authenticator, Authy, etc.) along with recovery codes.</p>
             <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-400 rounded-lg">
                    <thead class="text-xs uppercase bg-gray-800 text-gray-300">
                        <tr><th class="py-3 px-6">Endpoint</th><th class="py-3 px-6">Function</th></tr>
                    </thead>
                    <tbody>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>/mfa/setup</td><td>Generates TOTP secret/QR code URI for setup.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>/mfa/verify</td><td>Verifies the setup code to enable MFA.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>/mfa/validate-login</td><td>Completes login using an MFA code or recovery code.</td></tr>
                        <tr class="bg-gray-900 border-b border-gray-800"><td>/mfa/disable</td><td>Disables MFA for the current user.</td></tr>
                    </tbody>
                </table>
            </div>

            <h4>Social Login (\`/auth/{provider}\`)</h4>
            <p>If configured with client IDs and secrets, the <code>social_router</code> handles OAuth2 flows for providers like Google and GitHub, automatically linking or creating user accounts.</p>
        `;

        pages['middleware-session'] = `
            <h1>Middleware & Session Management</h1>
            <p>The <code>DatabaseSessionMiddleware</code> is the core security component that executes on every request.</p>

            <h4>Middleware Logic</h4>
            <ol class="list-decimal pl-6 space-y-2">
                <li>Extracts and decodes the JWT session token from the cookie or Bearer header.</li>
                <li>Periodically fetches the full session record from the database to ensure it's still active.</li>
                <li>Performs <strong>Session Hijack Detection</strong> by comparing the request's device and region with the session record. If they don't match, the session is invalidated.</li>
                <li>Rotates a per-request token (<code>random_string</code>) within the session to mitigate replay attacks.</li>
                <li>Injects <code>user_id</code> and <code>session_id</code> into <code>request.state</code> for dependencies.</li>
            </ol>
        `;

        pages['ui-dashboard'] = `
            <h1>UI Dashboard & Settings</h1>
            <p>AuthTuna includes a set of pre-built, user-facing pages for account management, served by the <code>ui_router</code>.</p>

            <h4>Endpoints</h4>
            <ul>
                <li><code>/ui/dashboard</code>: A welcome page showing basic account status.</li>
                <li><code>/ui/profile</code>: Allows the user to update their username.</li>
                <li><code>/ui/settings</code>: Provides forms for changing the password, managing MFA, and viewing/terminating active sessions.</li>
            </ul>
            <p>These templates are built with Tailwind CSS and are designed to be easily customized or replaced by pointing <code>DASHBOARD_AND_USER_INFO_PAGES_TEMPLATE_DIR</code> to your own template directory.</p>
        `;


        // --- Navigation Logic ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('-translate-x-full');
            sidebar.classList.toggle('translate-x-0');
            overlay.classList.toggle('hidden');
        }

        function navigate(pageId) {
            // 1. Update Content
            contentDiv.innerHTML = pages[pageId] || `<h1>404</h1><p>Documentation page not found for "\${pageId}".</p>`;

            // 2. Run Syntax Highlighting
            hljs.highlightAll();

            // 3. Update Active Class
            navLinks.forEach(link => {
                link.classList.remove('bg-indigo-600', 'text-white', 'font-semibold');
                link.classList.add('text-gray-300');
                if (link.getAttribute('data-page') === pageId) {
                    link.classList.add('bg-indigo-600', 'text-white', 'font-semibold');
                    link.classList.remove('text-gray-300');
                }
            });

            // 4. Update URL Hash
            history.pushState(null, null, '#' + pageId);

            // 5. Scroll to top on new page load & close sidebar on mobile
            document.querySelector('.doc-content-area').scrollTop = 0;
            if (window.innerWidth < 768) {
                toggleSidebar();
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            const initialPage = window.location.hash.substring(1) || 'introduction';
            navigate(initialPage);
            document.getElementById('menu-button').addEventListener('click', toggleSidebar);
        });

        // Handle browser back/forward buttons
        window.onpopstate = () => {
             const pageId = window.location.hash.substring(1) || 'introduction';
             navigate(pageId);
        };
    </script>
</body>
</html>